<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 4: Wiki Freeze & Presentation Panic - Le Grand Jamboree</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
            background-color: #f8fafc; /* Base color */
            transition: background-color 1.5s ease;
        }
        
        /* Level 1 Theme (RED) */
        .custom-red { 
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }
        
        .text-custom-red { 
            color: #dc2626; 
        }
        
        .custom-gold {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        /* Flashcard Styles */
        .flip-card {
            perspective: 1000px;
            width: 100%;
            height: 200px; 
        }
        
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-weight: bold;
            cursor: pointer;
        }
        
        .flip-card-front {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
        }
        
        .flip-card-back {
            background: white;
            color: #374151;
            border: 2px solid #b91c1c; 
            transform: rotateY(180deg);
        }

        /* Activity Styles */
        .choice-button {
            transition: all 0.2s ease;
            user-select: none;
        }

        .choice-button.correct {
            background-color: #10b981;
            color: white;
        }

        .choice-button.incorrect {
            background-color: #ef4444;
            color: white;
        }

        /* Server Upload Button Pulse */
        #upload-button {
            transition: all 0.1s ease;
        }

        /* Sleep Hours Pulse */
        .sleep-pulse {
            animation: sleepPulse 0.5s ease-in-out;
        }
        
        @keyframes sleepPulse {
            0% { transform: scale(1); background-color: #f59e0b; }
            50% { transform: scale(1.1); background-color: #ef4444; }
            100% { transform: scale(1); background-color: #f59e0b; }
        }

        /* Code Block Styling */
        .code-block {
            background-color: #1f2937; /* Gray 800 */
            color: #e5e7eb; /* Gray 200 */
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            white-space: pre-wrap;
            margin-bottom: 1rem;
        }
        .code-highlight {
            color: #fca5a5; /* Red 300 */
            font-weight: bold;
        }

        #hook-output {
            min-height: 80px;
            border-left: 4px solid #dc2626; /* RED */
            background-color: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: 500;
        }
    </style>
</head>
<body class="min-h-full font-sans transition-all bg-calme" id="game-body">
    <header class="bg-white shadow-sm border-b border-gray-100 sticky top-0 z-10">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="index.html" class="flex items-center space-x-1 sm:space-x-2">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center sm:w-16 sm:h-16">
                        <img src="FROG skippit RED.png" alt="igem barcelona-ub logo" class="w-full h-full object-cover p-2">
                    </div>
                    <span class="text-custom-red font-bold text-lg md:text-xl">MENU</span>
                </a>
                
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <div class="text-right">
                        <div class="text-base font-bold text-gray-900 sm:text-xl" id="score">0 / 160 pts</div>
                        <div class="text-xs text-gray-600 sm:text-sm">üò¥ Sleep Hours: 
                            <span id="sleep-hours" class="font-bold inline-flex items-center custom-gold text-white px-1 sm:px-2 rounded-full">8h</span>
                        </div>
                    </div>
                    <div class="w-16 sm:w-32 bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="progress-bar custom-red h-2 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                Level 4: Wiki Freeze & Presentation Panic üöÄ
            </h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                The final <strong>urgence</strong>! Solve the technical and presentation crises to <strong>survivre</strong> the Wiki Freeze!
            </p>
        </div>

        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-8" role="alert">
            <p class="font-bold">Last Stand: Sleep Hours (üò¥)</p>
            <p class="text-sm">The <strong>Wiki Freeze</strong> is imminent. Critical mistakes cost more time! If you run out, the Wiki remains a mess and you <strong>√©chouer</strong> the Jamboree!</p>
        </div>
        
        <section id="activity-1" class="activity-section mb-12">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">üß© 1. Flashcards: Wiki & Presentation Vocabulary</h2>
                <p class="text-gray-600 mb-6">Memorize these words. You will need them to fix your Wiki and prepare your final presentation!</p>
                
                <div class="grid md:grid-cols-4 gap-6" id="flashcards-container">
                    </div>
                
                <div id="flashcard-success" class="hidden mt-6 text-center">
                    <div class="flex flex-col w-full md:inline-flex md:flex-row items-center px-4 py-3 bg-green-100 text-green-800 rounded-lg mb-4">
                        <span class="mr-2">‚úÖ</span>
                        Excellent! You have mastered the Wiki vocabulary. (40 pts)
                    </div>
                    <button onclick="completeActivity(1)" class="custom-red text-white px-6 py-2 rounded-lg hover:opacity-90 transition-opacity" disabled id="activity-1-complete">
                        Continue to Code Crisis ‚Üí
                    </button>
                </div>
            </div>
        </section>

        <section id="activity-2" class="activity-section mb-12 hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">üíª 2. The Code Comma Crisis</h2>
                <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 mb-6">
                    <p class="font-bold text-sm">REMINDER: NO MORE CHANGES UNLESS CRITICAL!</p>
                </div>
                <p class="text-gray-600 mb-6">"AHHHHHH. I touched <strong>une virgule</strong>, and the whole page is broken. You need to <strong>corriger</strong> this CSS so the buttons <strong>fonctionner</strong> again. The button results does not <strong>fonctionner</strong>."</p>
                
                <div id="code-crisis-container">
                    </div>

                <div id="code-feedback" class="mt-6 text-center hidden">
                    <p class="text-xl font-semibold" id="feedback-text-code"></p>
                </div>

                <div id="code-success" class="mt-6 text-center hidden">
                    <div class="flex flex-col w-full md:inline-flex md:flex-row items-center px-4 py-3 bg-green-100 text-green-800 rounded-lg mb-4">
                        <span class="mr-2">‚úÖ</span>
                        <strong>Virgule</strong> Crisis Resolved! The CSS is fixed. (40 pts)
                    </div>
                    <button onclick="completeActivity(2)" class="custom-gold text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity mt-4 w-full" id="code-crisis-complete">
                        Continue to Server Overload ‚Üí
                    </button>
                </div>

            </div>
        </section>

        <section id="activity-3" class="activity-section mb-12 hidden">
            <div class="bg-white rounded-xl shadow-lg p-8 fade-in" id="upload-container">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">‚è∞ 3. Server Overload: The Wiki Freeze</h2>
                <p class="text-lg text-gray-600 font-semibold mb-6">"The Wiki won't upload because the <strong>serveur</strong> is overloaded, everyone is doing it at the last minute! You need to be faster than the rest! Click the upload button 10 times in under 5 seconds to <strong>t√©l√©charger</strong>."</p>

                <div class="text-center mb-6">
                    <div class="text-5xl font-bold text-custom-red mb-4" id="upload-timer">5.0s</div>
                    <div class="text-xl font-semibold text-gray-900">T√©l√©chargements Requis: <span id="upload-count" class="text-red-600">10</span></div>
                </div>

                <div class="text-center">
                    <button id="upload-button" onclick="handleUploadAttempt()" class="custom-red text-white px-10 py-5 rounded-lg font-semibold text-2xl hover:scale-105 transition-transform" disabled> 
                        T√âL√âCHARGER WIKI! üöÄ 
                    </button>
                </div>

                <div id="upload-success" class="hidden mt-6 text-center">
                    <div class="flex flex-col w-full md:inline-flex md:flex-row items-center px-4 py-3 bg-green-100 text-green-800 rounded-lg mb-4">
                        <span class="mr-2">üéâ</span> WIKI UPLOADED! The <strong>serveur</strong> was crashing, but you made it! (40 pts)
                    </div>
                    <button onclick="completeActivity(3)" class="custom-red text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity" id="activity-3-complete"> 
                        ‚úì Continue to Menu Mayhem 
                    </button>
                </div>

                <div id="upload-failure" class="hidden mt-6 text-center">
                    <div class="flex flex-col w-full md:inline-flex md:flex-row items-center px-4 py-3 bg-red-100 text-red-800 rounded-lg mb-4">
                        <span class="mr-2">üò©</span> SERVER CRASH! Time's up. -1.0h Sleep!
                    </div>
                    <button onclick="startUploadChallenge()" class="custom-red text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"> 
                        R√©p√©ter! (Try Again) 
                    </button>
                </div>
            </div>
        </section>

        <section id="activity-4" class="activity-section mb-12 hidden">
            <div class="bg-white rounded-xl shadow-lg p-8 fade-in">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">üîó 4. The Menu Mayhem</h2>
                <p class="text-gray-600 mb-4">"Oh no, the <strong>menu</strong> stopped working hours before the Wiki Freeze! The links are broken. Click in the correct order to match the Menu Text (Left) with the Section <strong>Lien</strong> (Right)."</p>
                
                <div class="flex flex-col md:flex-row items-start justify-center space-y-8 md:space-y-0 md:space-x-12">
                    <div id="menu-text-container" class="grid gap-3 w-full md:w-1/3">
                        </div>
                    
                    <div id="match-status" class="w-full md:w-1/3 text-center self-center">
                        <div class="text-2xl font-bold text-gray-700" id="current-match-text">Ready</div>
                        <div class="text-6xl my-4 text-gray-400">‚ÜîÔ∏è</div>
                        <div class="text-lg font-semibold text-gray-500" id="matched-count">0/4 Matched</div>
                    </div>
                    
                    <div id="menu-link-container" class="grid gap-3 w-full md:w-1/3">
                        </div>
                </div>

                <div id="menu-success" class="hidden mt-8 text-center">
                    <div class="flex flex-col w-full md:inline-flex md:flex-row items-center px-4 py-3 bg-green-100 text-green-800 rounded-lg mb-4">
                        <span class="mr-2">‚úÖ</span>
                        Menu Restored! Your final check is complete. (40 pts)
                    </div>
                    <button onclick="completeActivity(4)" class="custom-red text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity" id="activity-4-complete"> 
                        J'ai Termin√© le Level 4! üèÜ
                    </button>
                </div>
            </div>
        </section>
        
        <div id="level-complete" class="hidden bg-green-50 rounded-xl p-10 text-center shadow-2xl border-t-4 border-green-500 mt-12">
            <h2 class="text-3xl font-bold text-green-800 mb-4">üéâ F√©licitations! Level 4 Termin√©!</h2>
            <p class="text-xl text-gray-700 mb-6">You have survived the Wiki Freeze and are ready for the final presentation. You recovered a total of <span id="final-score" class="font-bold text-green-600">0</span> points.</p>
            <a href="level5.html" class="custom-gold text-white px-8 py-4 rounded-lg text-xl font-semibold hover:opacity-90 transition-opacity">
                Aller au Grand Jamboree! ‚Üí
            </a>
        </div>
    </main>
    
    <script>
        // --- SCROLL-TO-TOP FIX (Asegura que siempre cargue al principio) ---
        window.onload = function() {
            window.scrollTo(0, 0);
        };
        // --- FIN SCROLL-TO-TOP FIX ---

        // Variables y l√≥gica del juego (NO MODIFICADO AQU√ç, pero se asume que existe)
        const TOTAL_POINTS = 160;
        let currentScore = 0;
        let sleepHours = 8.0; 
        const SLEEP_HOUR_LOSS = 0.5;
        let flippedCards = new Set();
        let currentActivity = 1;
        
        // Data for Flashcards
        const flashcards = [
            { french: "Serveur", english: "Server" },
            { french: "Virgule", english: "Comma" },
            { french: "T√©l√©charger", english: "To Upload/Download" },
            { french: "Pr√©sentation", english: "Presentation" },
            { french: "Corriger", english: "To Correct/Fix" },
            { french: "√âchouer", english: "To Fail" },
            { french: "Fonctionner", english: "To Function/Work" },
            { french: "Menu", english: "Menu" }
        ];

        // --- GAME FLOW FUNCTIONS ---

        function updateScore(points) {
            currentScore += points;
            document.getElementById('score').textContent = `${currentScore} / ${TOTAL_POINTS} pts`;
        }

        function updateSleepHours(hoursChange) {
            sleepHours = Math.max(0, sleepHours + hoursChange); // Sleep can't go below 0
            const sleepElement = document.getElementById('sleep-hours');
            sleepElement.textContent = `${sleepHours.toFixed(1)}h`;

            if (hoursChange < 0) {
                sleepElement.classList.add('sleep-pulse');
                setTimeout(() => sleepElement.classList.remove('sleep-pulse'), 500);
            }
        }
        
        function updateProgress() {
            const progress = Math.round(((currentActivity - 1) / 4) * 100);
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }
        
        function generateFlashcards() {
            const container = document.getElementById('flashcards-container');
            // Logic to generate flashcards... (omitted for brevity)
            container.innerHTML = flashcards.map(card => `
                <div class="flip-card" onclick="flipCard(this, '${card.french}')">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="text-2xl font-bold mb-2">${card.french}</div>
                            <div class="text-sm opacity-80">Click to view</div>
                        </div>
                        <div class="flip-card-back">
                            <div>
                                <div class="text-lg font-semibold text-gray-800 mb-2">${card.english}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function flipCard(cardElement, frenchWord) {
            if (!cardElement.classList.contains('flipped')) {
                cardElement.classList.add('flipped');
                flippedCards.add(frenchWord);
                if (flippedCards.size === flashcards.length) {
                    document.getElementById('flashcard-success').classList.remove('hidden');
                    document.getElementById('activity-1-complete').disabled = false;
                    updateScore(40);
                }
            }
        }
        
        function completeActivity(activityNumber) {
            document.getElementById(`activity-${activityNumber}`).classList.add('hidden');
            currentActivity++;
            updateProgress();
            
            if (activityNumber === 1) {
                document.getElementById('activity-2').classList.remove('hidden');
                initCodeCrisis();
            } else if (activityNumber === 2) {
                document.getElementById('activity-3').classList.remove('hidden');
                startUploadChallenge();
            } else if (activityNumber === 3) {
                document.getElementById('activity-4').classList.remove('hidden');
                initMenuMayhem();
            } else if (activityNumber === 4) {
                // FINAL ACTIVITY
                document.getElementById('level-complete').classList.remove('hidden');
                document.getElementById('final-score').textContent = currentScore;
            }
        }

        // --- Activity 2: Code Crisis (Simulaci√≥n) ---
        function initCodeCrisis() {
            // Placeholder logic for the code crisis simulation
            const container = document.getElementById('code-crisis-container');
            container.innerHTML = `
                <div class="code-block">
                    .button-result {<br>
                    &nbsp;&nbsp;<span class="code-highlight">display: none</span><br>
                    }
                </div>
                <div class="flex space-x-4 justify-center">
                    <button onclick="checkCodeFix(true)" class="choice-button bg-green-500 text-white px-6 py-3 rounded-lg font-semibold">Fix 1: Add a semicolon</button>
                    <button onclick="checkCodeFix(false)" class="choice-button bg-yellow-500 text-white px-6 py-3 rounded-lg font-semibold">Fix 2: Remove the display property</button>
                </div>
            `;
        }

        function checkCodeFix(isCorrect) {
            const feedbackText = document.getElementById('feedback-text-code');
            const feedbackBox = document.getElementById('code-feedback');
            feedbackBox.classList.remove('hidden');
            
            if (isCorrect) {
                feedbackText.textContent = "CORRECT! The semicolon was missing. 'Une virgule' refers to any small, critical typo.";
                feedbackText.classList.remove('text-red-600');
                feedbackText.classList.add('text-green-600');
                document.getElementById('code-crisis-container').querySelectorAll('.choice-button').forEach(btn => btn.disabled = true);
                document.getElementById('code-success').classList.remove('hidden');
            } else {
                updateSleepHours(-SLEEP_HOUR_LOSS);
                feedbackText.textContent = "INCORRECT! That didn't fix the CSS. -0.5h Sleep.";
                feedbackText.classList.remove('text-green-600');
                feedbackText.classList.add('text-red-600');
            }
        }
        
        // --- Activity 3: Server Overload (Clicker) ---
        let requiredClicks = 10;
        let clicks = 0;
        let timer = 5.0;
        let timerInterval;

        function startUploadChallenge() {
            document.getElementById('upload-failure').classList.add('hidden');
            clicks = 0;
            timer = 5.0;
            document.getElementById('upload-count').textContent = requiredClicks;
            document.getElementById('upload-timer').textContent = `${timer.toFixed(1)}s`;
            document.getElementById('upload-button').disabled = false;
            document.getElementById('upload-button').classList.remove('custom-red', 'custom-gold');
            document.getElementById('upload-button').classList.add('custom-red'); // Initial state
            
            timerInterval = setInterval(() => {
                timer -= 0.1;
                document.getElementById('upload-timer').textContent = `${timer.toFixed(1)}s`;
                
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('upload-button').disabled = true;
                    document.getElementById('upload-failure').classList.remove('hidden');
                    updateSleepHours(-1.0); // Lost 1 full hour
                }
            }, 100);
        }
        
        function handleUploadAttempt() {
            if (clicks < requiredClicks) {
                clicks++;
                document.getElementById('upload-count').textContent = requiredClicks - clicks;
                
                // Visual feedback on click
                document.getElementById('upload-button').style.transform = 'scale(0.98)';
                setTimeout(() => {
                    document.getElementById('upload-button').style.transform = 'scale(1)';
                }, 50);
                
                if (clicks === requiredClicks) {
                    clearInterval(timerInterval);
                    document.getElementById('upload-button').disabled = true;
                    document.getElementById('upload-success').classList.remove('hidden');
                    updateScore(40);
                }
            }
        }
        
        // --- Activity 4: Menu Mayhem (Matching) ---
        const menuItems = [
            { text: "Accueil", link: "#home" },
            { text: "L'√âquipe", link: "#team" },
            { text: "Projet", link: "#project" },
            { text: "R√©sultats", link: "#results" }
        ];

        let selectedLeft = null;

        function initMenuMayhem() {
            const textContainer = document.getElementById('menu-text-container');
            const linkContainer = document.getElementById('menu-link-container');
            
            // Randomize links for the right side
            const shuffledLinks = [...menuItems].sort(() => 0.5 - Math.random());

            textContainer.innerHTML = menuItems.map(item => `
                <button class="choice-button bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300" data-type="text" data-match="${item.link}" onclick="handleMatch(this)">
                    ${item.text}
                </button>
            `).join('');

            linkContainer.innerHTML = shuffledLinks.map(item => `
                <button class="choice-button bg-gray-200 text-gray-700 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300" data-type="link" data-match="${item.link}" onclick="handleMatch(this)">
                    ${item.link}
                </button>
            `).join('');
        }

        function handleMatch(element) {
            if (element.classList.contains('correct')) return;
            
            if (element.dataset.type === 'text') {
                if (selectedLeft) {
                    selectedLeft.classList.remove('bg-gray-700', 'text-white');
                }
                selectedLeft = element;
                selectedLeft.classList.add('bg-gray-700', 'text-white');
                document.getElementById('current-match-text').textContent = selectedLeft.textContent + ' selected...';
            } else if (element.dataset.type === 'link' && selectedLeft) {
                // Check match
                if (selectedLeft.dataset.match === element.dataset.match) {
                    // Correct Match
                    selectedLeft.classList.add('correct', 'bg-green-600');
                    element.classList.add('correct', 'bg-green-600');
                    selectedLeft.disabled = true;
                    element.disabled = true;
                    
                    selectedLeft = null;
                    let matchedCount = document.querySelectorAll('#menu-text-container .correct').length;
                    document.getElementById('matched-count').textContent = `${matchedCount}/4 Matched`;
                    document.getElementById('current-match-text').textContent = "Matched!";
                    
                    if (matchedCount === menuItems.length) {
                        document.getElementById('menu-success').classList.remove('hidden');
                        updateScore(40);
                    }
                } else {
                    // Incorrect Match
                    updateSleepHours(-SLEEP_HOUR_LOSS);
                    selectedLeft.classList.add('bg-red-500', 'text-white');
                    element.classList.add('bg-red-500', 'text-white');
                    document.getElementById('current-match-text').textContent = "Mismatch! Try again. -0.5h Sleep.";
                    setTimeout(() => {
                        selectedLeft.classList.remove('bg-red-500', 'text-white', 'bg-gray-700');
                        element.classList.remove('bg-red-500', 'text-white');
                        selectedLeft = null;
                        document.getElementById('current-match-text').textContent = "Ready";
                    }, 1000);
                }
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            generateFlashcards();
            updateSleepHours(0);
            updateProgress();
        });
    </script>
</body>
</html>